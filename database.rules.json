{
  "rules": {
    ".read": true,
    ".write": true,

    "lobbies": {
      ".indexOn": ["status", "createdAt", "hostUid", "updatedAt"],

      "$lobbyCode": {
        ".read": true,
        ".write": true,

        "code": {
          ".read": true,
          ".write": true
        },

        "hostUid": {
          ".read": true,
          ".write": true
        },

        "hostDisplayName": {
          ".read": true,
          ".write": true
        },

        "status": {
          ".read": true,
          ".write": true
        },

        "maxPlayers": {
          ".read": true,
          ".write": true
        },

        "createdAt": {
          ".read": true,
          ".write": true
        },

        "updatedAt": {
          ".read": true,
          ".write": true
        },

        "settings": {
          ".read": true,
          ".write": true,

          "rounds": {
            ".read": true,
            ".write": true
          },

          "timeLimit": {
            ".read": true,
            ".write": true
          },

          "categories": {
            ".read": true,
            ".write": true,
            "$category": {
              ".read": true,
              ".write": true
            }
          }
        },

        "players": {
          ".indexOn": ["joinedAt", "isHost", "status", "lastSeen"],
          ".read": true,
          ".write": true,

          "$playerUid": {
            ".read": true,
            ".write": true,

            "displayName": {
              ".read": true,
              ".write": true
            },

            "avatarId": {
              ".read": true,
              ".write": true
            },

            "profileURL": {
              ".read": true,
              ".write": true
            },

            "joinedAt": {
              ".read": true,
              ".write": true
            },

            "isHost": {
              ".read": true,
              ".write": true
            },

            "score": {
              ".read": true,
              ".write": true
            },

            "status": {
              ".read": true,
              ".write": true
            },

            "lastSeen": {
              ".read": true,
              ".write": true
            }
          }
        },

        "gameState": {
          ".read": true,
          ".write": true,

          "currentRound": {
            ".read": true,
            ".write": true
          },

          "phase": {
            ".read": true,
            ".write": true
          },

          "phaseStartTime": {
            ".read": true,
            ".write": true
          },

          "currentSituation": {
            ".read": true,
            ".write": true
          },

          "submissions": {
            ".read": true,
            ".write": true,
            "$submissionPlayerUid": {
              ".read": true,
              ".write": true,

              "cardId": {
                ".read": true,
                ".write": true
              },

              "caption": {
                ".read": true,
                ".write": true
              },

              "submittedAt": {
                ".read": true,
                ".write": true
              }
            }
          },

          "votes": {
            ".read": true,
            ".write": true,
            "$voterUid": {
              ".read": true,
              ".write": true
            }
          },

          "roundResults": {
            ".read": true,
            ".write": true,

            "winner": {
              ".read": true,
              ".write": true
            },

            "votes": {
              ".read": true,
              ".write": true
            },

            "winningSubmission": {
              ".read": true,
              ".write": true,
              "cardId": {
                ".read": true,
                ".write": true
              },

              "caption": {
                ".read": true,
                ".write": true
              }
            }
          }
        },

        "chat": {
          ".indexOn": ["timestamp"],
          ".read": true,
          ".write": true,

          "$messageId": {
            ".read": true,
            ".write": true,

            "playerId": {
              ".read": true,
              ".write": true
            },

            "playerName": {
              ".read": true,
              ".write": true
            },

            "message": {
              ".read": true,
              ".write": true
            },

            "timestamp": {
              ".read": true,
              ".write": true
            },

            "type": {
              ".read": true,
              ".write": true
            }
          }
        }
      }
    },

    "playerSessions": {
      ".indexOn": ["lastActivity", "connectionStatus"],
      ".read": true,
      ".write": true,

      "$playerUid": {
        ".read": true,
        ".write": true,

        "currentLobby": {
          ".read": true,
          ".write": true
        },

        "lastActivity": {
          ".read": true,
          ".write": true
        },

        "connectionStatus": {
          ".read": true,
          ".write": true
        }
      }
    },

    "rateLimits": {
      ".read": true,
      ".write": true,
      "$userId": {
        ".read": true,
        ".write": true,

        "lobbyCreation": {
          ".indexOn": ["lastCreated", "count"],
          ".read": true,
          ".write": true,

          "count": {
            ".read": true,
            ".write": true
          },

          "lastCreated": {
            ".read": true,
            ".write": true
          },

          "windowStart": {
            ".read": true,
            ".write": true
          }
        },

        "chatMessages": {
          ".indexOn": ["lastMessage", "count"],
          ".read": true,
          ".write": true,

          "count": {
            ".read": true,
            ".write": true
          },

          "lastMessage": {
            ".read": true,
            ".write": true
          },

          "windowStart": {
            ".read": true,
            ".write": true
          }
        },

        "settingsUpdates": {
          ".indexOn": ["lastUpdate", "count"],
          ".read": true,
          ".write": true,

          "count": {
            ".read": true,
            ".write": true
          },

          "lastUpdate": {
            ".read": true,
            ".write": true
          },

          "windowStart": {
            ".read": true,
            ".write": true
          }
        }
      }
    },

    "battleRoyaleQueue": {
      ".indexOn": ["queuedAt", "skillRating", "region"],
      ".read": true,
      ".write": true,

      "$playerUid": {
        ".read": true,
        ".write": "$playerUid === auth.uid",

        "playerUid": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "displayName": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "avatarId": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "profileURL": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "skillRating": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "xpLevel": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "queuedAt": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "estimatedWaitTime": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "preferences": {
          ".read": true,
          ".write": "$playerUid === auth.uid",

          "maxWaitTime": {
            ".read": true,
            ".write": "$playerUid === auth.uid"
          },

          "skillRangeFlexibility": {
            ".read": true,
            ".write": "$playerUid === auth.uid"
          },

          "regionPreference": {
            ".read": true,
            ".write": "$playerUid === auth.uid"
          }
        },

        "connectionInfo": {
          ".read": true,
          ".write": "$playerUid === auth.uid",

          "region": {
            ".read": true,
            ".write": "$playerUid === auth.uid"
          },

          "latency": {
            ".read": true,
            ".write": "$playerUid === auth.uid"
          },

          "connectionQuality": {
            ".read": true,
            ".write": "$playerUid === auth.uid"
          }
        }
      }
    },

    "battleRoyaleStats": {
      ".indexOn": ["skillRating", "gamesPlayed", "lastPlayed", "winRate"],
      ".read": true,
      ".write": true,

      "$playerUid": {
        ".read": true,
        ".write": "$playerUid === auth.uid",

        "gamesPlayed": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "wins": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "losses": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "winRate": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "skillRating": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "highestRating": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "currentStreak": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "longestWinStreak": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "averagePosition": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "totalXpEarned": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "achievements": {
          ".read": true,
          ".write": "$playerUid === auth.uid",
          "$achievementId": {
            ".read": true,
            ".write": "$playerUid === auth.uid"
          }
        },

        "lastPlayed": {
          ".read": true,
          ".write": "$playerUid === auth.uid"
        },

        "seasonStats": {
          ".read": true,
          ".write": "$playerUid === auth.uid",
          "$seasonId": {
            ".read": true,
            ".write": "$playerUid === auth.uid"
          }
        }
      }
    },

    "matchmakingHistory": {
      ".indexOn": ["createdAt", "matchQuality", "averageSkillRating"],
      ".read": true,
      ".write": true,

      "$matchId": {
        ".read": true,
        ".write": true,

        "matchId": {
          ".read": true,
          ".write": true
        },

        "averageSkillRating": {
          ".read": true,
          ".write": true
        },

        "skillRatingRange": {
          ".read": true,
          ".write": true
        },

        "matchQuality": {
          ".read": true,
          ".write": true
        },

        "createdAt": {
          ".read": true,
          ".write": true
        },

        "lobbyCode": {
          ".read": true,
          ".write": true
        },

        "estimatedDuration": {
          ".read": true,
          ".write": true
        },

        "players": {
          ".read": true,
          ".write": true,
          "$playerUid": {
            ".read": true,
            ".write": true,

            "position": {
              ".read": true,
              ".write": true
            },

            "skillRatingChange": {
              ".read": true,
              ".write": true
            },

            "xpEarned": {
              ".read": true,
              ".write": true
            },

            "submittedAt": {
              ".read": true,
              ".write": true
            }
          }
        }
      }
    },

    "queueMetrics": {
      ".indexOn": ["lastUpdated"],
      ".read": true,
      ".write": true,

      "currentQueueSize": {
        ".read": true,
        ".write": true
      },

      "averageWaitTime": {
        ".read": true,
        ".write": true
      },

      "lastUpdated": {
        ".read": true,
        ".write": true
      },

      "peakHours": {
        ".read": true,
        ".write": true
      },

      "matchesCreatedToday": {
        ".read": true,
        ".write": true
      },

      "averageMatchQuality": {
        ".read": true,
        ".write": true
      }
    }
  }
}
